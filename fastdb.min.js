angular.module("fastDbModule",[]).constant("DB",{name:"idrf",version:1}).constant("STORE","keyvaluepairs").factory("$fastdb",["DB","STORE","$q",function(a,b,c){var d,e=indexedDB.open(a.name,a.version);return e.onerror=function(a){throw console.error("An error happened "),new Error(a)},e.onupgradeneeded=function(c){d=c.target.result,console.warn("UPGRADING TO "+a.version);d.createObjectStore(b,{keyPath:"key"})},e.onsuccess=function(b){d=b.target.result,console.info("CONECTED TO "+a.name)},{setItem:function(a,e){var f=c.defer(),g=d.transaction([b],"readwrite"),h=g.objectStore(b);""===a&&console.warn("--- EMPTY KEY USED ---");var i=h.put(e,a);return i.onerror=function(a){f.reject(a)},i.onsuccess=function(a){f.resolve(e)},f.promise},entries:function(){var a=c.defer(),e=d.transaction([b],"readonly"),f=e.objectStore(b),g=f.openCursor(),h={};return g.onerror=function(b){a.reject(b)},g.onsuccess=function(b){var c=g.result;c?(h[c.key]=c.value,c.continue()):a.resolve(h)},a.promise},getItem:function(a){var e=c.defer(),f=d.transaction([b],"readonly"),g=f.objectStore(b),h=g.get(a);return h.onerror=function(a){e.reject(a)},h.onsuccess=function(a){var b=a.target.result;e.resolve(b)},e.promise},clear:function(){var a=c.defer(),e=d.transaction([b],"readwrite"),f=e.objectStore(b),g=f.clear();return g.onerror=function(b){a.reject(b)},g.onsuccess=function(b){a.resolve(b)},a.promise},removeItem:function(a){var e=c.defer(),f=d.transaction([b],"readwrite"),g=f.objectStore(b),h=g.delete(a);return h.onerror=function(a){e.reject(a)},h.onsuccess=function(a){e.resolve(a)},e.promise},length:function(){var a=c.defer(),e=d.transaction([b],"readonly"),f=e.objectStore(b),g=f.openCursor(),h=0;return g.onerror=function(b){a.reject(b)},g.onsuccess=function(b){var c=g.result;c?(h+=1,c.continue()):a.resolve(h)},a.promise},keys:function(){var a=c.defer(),e=d.transaction([b],"readonly"),f=e.objectStore(b),g=f.openCursor(),h=[];return g.onerror=function(b){a.reject(b)},g.onsuccess=function(b){var c=g.result;c?(h.push(c.key),c.continue()):a.resolve(h)},a.promise},key:function(a){var e=c.defer(),f=d.transaction([b],"readonly"),g=f.objectStore(b),h=g.openCursor(),i=0;return h.onerror=function(a){e.reject(a)},h.onsuccess=function(b){var c=h.result;c?i==a?e.resolve(c.key):(i+=1,c.continue()):e.resolve(null)},e.promise}}}]);